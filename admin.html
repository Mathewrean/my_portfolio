<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portfolio Admin Dashboard</title>
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <script defer src="assets/js/admin.js"></script>
</head>
<body>
  <button id="themeToggle" class="floating-theme-toggle" aria-label="Toggle dark and light mode" title="Toggle theme">‚óê</button>

  <div id="authGate" class="auth-gate">
    <section class="view-section active" style="max-width: 420px; width: 100%;">
      <h2>Admin Login</h2>
      <p class="muted">Secure area for portfolio content management.</p>
      <form id="authForm" class="stack">
        <label>Password
          <input id="adminPassphrase" type="password" required autocomplete="current-password" />
        </label>
        <button class="btn btn-primary" type="submit">Sign In</button>
      </form>
      <p id="authMessage" class="muted"></p>
    </section>
  </div>

  <div id="adminApp" class="admin-layout" hidden>
    <aside class="admin-sidebar">
      <h1>Admin</h1>
      <nav class="admin-menu">
        <button class="admin-nav-btn active" data-panel="challenges">Challenges</button>
        <button class="admin-nav-btn" data-panel="certificates">Certificates</button>
        <button class="admin-nav-btn" data-panel="projects">Projects</button>
        <button class="admin-nav-btn" data-panel="research">Research</button>
        <button class="admin-nav-btn" data-panel="gallery">Gallery</button>
        <button class="admin-nav-btn" data-panel="settings">Settings</button>
      </nav>
    </aside>

    <section class="admin-main">
      <header class="admin-topbar">
        <h2 id="panelTitle">Challenges</h2>
        <div style="display:flex; gap:.5rem; align-items:center;">
          <span id="modeTag" class="tag">Mode</span>
          <button id="logoutBtn" class="btn">Logout</button>
        </div>
      </header>

      <div id="toast" class="toast" hidden></div>

      <section class="admin-panel active" data-panel="challenges">
        <div class="toolbar">
          <input id="challengeSearch" type="search" placeholder="Search challenges" />
          <select id="challengePlatformFilter">
            <option value="">All platforms</option>
          </select>
          <select id="challengeCategoryFilter">
            <option value="">All categories</option>
          </select>
          <button id="challengeFilterBtn" class="btn">Apply</button>
        </div>
        <div class="table-wrap"><table><thead><tr><th>Title</th><th>Platform</th><th>Categories</th><th>Status</th><th>Published</th><th>Actions</th></tr></thead><tbody id="challengesTable"></tbody></table></div>
        <div class="toolbar"><button id="challengePrev" class="btn">Prev</button><span id="challengePageInfo" class="muted"></span><button id="challengeNext" class="btn">Next</button></div>

        <details open class="admin-card"><summary>Add / Edit Challenge</summary>
          <form id="challengeForm" class="form-grid" enctype="multipart/form-data">
            <input type="hidden" id="challengeId" />
            <label>Title<input id="challengeTitle" required /></label>
            <label>Platform
              <select id="challengePlatform" required>
                <option value="TryHackMe">TryHackMe</option>
                <option value="HackTheBox">HackTheBox</option>
                <option value="PicoCTF">PicoCTF</option>
                <option value="CTFROOM">CTFROOM</option>
                <option value="CTFZone">CTFZone</option>
                <option value="Others">Others</option>
                <option value="CyberDefenders">CyberDefenders</option>
                <option value="Root-Me">Root-Me</option>
                <option value="OverTheWire">OverTheWire</option>
                <option value="VulnHub">VulnHub</option>
                <option value="PortSwigger Labs">PortSwigger Labs</option>
                <option value="RingZer0">RingZer0</option>
                <option value="HackThisSite">HackThisSite</option>
                <option value="CTFtime Events">CTFtime Events</option>
              </select>
            </label>
            <label>Difficulty<input id="challengeDifficulty" placeholder="Easy/Medium/Hard" /></label>
            <label>Status<select id="challengeStatus"><option>Completed</option><option>Ongoing</option></select></label>
            <label>Date completed<input id="challengeDate" type="date" /></label>
            <label class="full">CTF Categories</label>
            <div id="challengeCategoryChecks" class="tags full">
              <label class="tag"><input type="checkbox" value="Web" /> Web</label>
              <label class="tag"><input type="checkbox" value="Pwn" /> Pwn</label>
              <label class="tag"><input type="checkbox" value="Crypto" /> Crypto</label>
              <label class="tag"><input type="checkbox" value="Reverse Engineering" /> Reverse Engineering</label>
              <label class="tag"><input type="checkbox" value="Forensics" /> Forensics</label>
              <label class="tag"><input type="checkbox" value="OSINT" /> OSINT</label>
              <label class="tag"><input type="checkbox" value="Misc" /> Misc</label>
            </div>
            <label>Medium link<input id="challengeMedium" type="url" /></label>
            <label class="full">Description (Rich text)
              <div id="challengeDescriptionEditor" class="rich-editor" contenteditable="true"></div>
            </label>
            <label>Thumbnail image<input id="challengeThumbnail" type="file" accept=".jpg,.jpeg,.png,.webp" /></label>
            <label>Thumbnail JSON path<input id="challengeThumbnailPath" type="text" readonly /></label>
            <div class="full card">
              <p class="meta">Live Preview</p>
              <div id="challengePreview"></div>
            </div>
            <label>Published<select id="challengePublished"><option value="1">Yes</option><option value="0">No</option></select></label>
            <div class="full toolbar">
              <button class="btn btn-primary" type="submit">Save Challenge</button>
              <button class="btn" type="button" id="challengeReset">Reset</button>
            </div>
          </form>
        </details>
      </section>

      <section class="admin-panel" data-panel="certificates">
        <div class="table-wrap"><table><thead><tr><th>Title</th><th>Issuer</th><th>Date</th><th>Published</th><th>Actions</th></tr></thead><tbody id="certTable"></tbody></table></div>
        <details open class="admin-card"><summary>Add / Edit Certificate</summary>
          <form id="certForm" class="form-grid" enctype="multipart/form-data">
            <input type="hidden" id="certId" />
            <label>Title<input id="certTitle" required /></label>
            <label>Issuer<input id="certIssuer" required /></label>
            <label>Date<input id="certDate" type="date" /></label>
            <label>Credential ID<input id="certCredential" /></label>
            <label>Verification link<input id="certVerify" type="url" /></label>
            <label>Certificate file/image<input id="certImage" type="file" accept=".pdf,.jpg,.jpeg,.png,.webp" /></label>
            <label>Published<select id="certPublished"><option value="1">Yes</option><option value="0">No</option></select></label>
            <div class="full toolbar"><button class="btn btn-primary" type="submit">Save Certificate</button><button class="btn" type="button" id="certReset">Reset</button></div>
          </form>
        </details>
      </section>

      <section class="admin-panel" data-panel="projects">
        <div class="table-wrap"><table><thead><tr><th>Title</th><th>Tech</th><th>Published</th><th>Actions</th></tr></thead><tbody id="projectsTable"></tbody></table></div>
        <details open class="admin-card"><summary>Add / Edit Project</summary>
          <form id="projectForm" class="form-grid" enctype="multipart/form-data">
            <input type="hidden" id="projectId" />
            <label>Title<input id="projectTitle" required /></label>
            <label>Technologies (comma separated)<input id="projectTech" /></label>
            <label>GitHub link<input id="projectGithub" type="url" /></label>
            <label>Live link<input id="projectLive" type="url" /></label>
            <label>Image<input id="projectImage" type="file" accept=".jpg,.jpeg,.png,.webp" /></label>
            <label class="full">Description<textarea id="projectDescription" rows="4" required></textarea></label>
            <label>Published<select id="projectPublished"><option value="1">Yes</option><option value="0">No</option></select></label>
            <div class="full toolbar"><button class="btn btn-primary" type="submit">Save Project</button><button class="btn" type="button" id="projectReset">Reset</button></div>
          </form>
        </details>
      </section>

      <section class="admin-panel" data-panel="research">
        <div class="table-wrap"><table><thead><tr><th>Title</th><th>Date</th><th>Published</th><th>Actions</th></tr></thead><tbody id="researchTable"></tbody></table></div>
        <details open class="admin-card"><summary>Add / Edit Research</summary>
          <form id="researchForm" class="form-grid" enctype="multipart/form-data">
            <input type="hidden" id="researchId" />
            <label>Title<input id="researchTitle" required /></label>
            <label>Date<input id="researchDate" type="date" /></label>
            <label>Link<input id="researchLink" type="url" /></label>
            <label>Upload PDF/Image<input id="researchAttachment" type="file" accept=".pdf,.jpg,.jpeg,.png,.webp" /></label>
            <label class="full">Description<textarea id="researchDescription" rows="4" required></textarea></label>
            <label>Published<select id="researchPublished"><option value="1">Yes</option><option value="0">No</option></select></label>
            <div class="full toolbar"><button class="btn btn-primary" type="submit">Save Research</button><button class="btn" type="button" id="researchReset">Reset</button></div>
          </form>
        </details>
      </section>

      <section class="admin-panel" data-panel="gallery">
        <div class="table-wrap"><table><thead><tr><th>Caption</th><th>Date</th><th>Published</th><th>Actions</th></tr></thead><tbody id="galleryTable"></tbody></table></div>
        <details open class="admin-card"><summary>Add / Edit Gallery Item</summary>
          <form id="galleryForm" class="form-grid" enctype="multipart/form-data">
            <input type="hidden" id="galleryId" />
            <label>Caption<input id="galleryCaption" /></label>
            <label>Date<input id="galleryDate" type="date" /></label>
            <label>Image<input id="galleryImage" type="file" accept=".jpg,.jpeg,.png,.webp" required /></label>
            <label>Published<select id="galleryPublished"><option value="1">Yes</option><option value="0">No</option></select></label>
            <div class="full toolbar"><button class="btn btn-primary" type="submit">Save Gallery Item</button><button class="btn" type="button" id="galleryReset">Reset</button></div>
          </form>
        </details>
      </section>

      <section class="admin-panel" data-panel="settings">
        <details open class="admin-card"><summary>Site Settings</summary>
          <form id="siteSettingsForm" class="form-grid">
            <label class="full">Hero Title<input id="siteHeroTitle" /></label>
            <label class="full">Hero Summary<textarea id="siteHeroSummary" rows="2"></textarea></label>
            <label class="full">About<textarea id="siteAbout" rows="4"></textarea></label>
            <label class="full">Contact Links JSON<textarea id="siteContact" rows="5" placeholder='[{"label":"Email","href":"mailto:..."}]'></textarea></label>
            <label>TryHackMe profile URL<input id="thmProfileUrl" type="url" /></label>
            <label>TryHackMe badge image URL<input id="thmBadgeImage" type="url" /></label>
            <div class="full toolbar"><button class="btn btn-primary" type="submit">Save Site Settings</button></div>
          </form>
        </details>

        <details open class="admin-card"><summary>Static JSON Export (GitHub Pages)</summary>
          <p class="muted">Use these buttons after editing forms in Static JSON Mode, then replace files in <code>docs/data/</code> and push to GitHub.</p>
          <div class="toolbar">
            <button id="downloadSiteJson" class="btn" type="button">Download site.json</button>
            <button id="downloadChallengesJson" class="btn" type="button">Download challenges.json</button>
            <button id="downloadCertificatesJson" class="btn" type="button">Download certificates.json</button>
            <button id="downloadProjectsJson" class="btn" type="button">Download projects.json</button>
            <button id="downloadResearchJson" class="btn" type="button">Download research.json</button>
            <button id="downloadGalleryJson" class="btn" type="button">Download gallery.json</button>
          </div>
        </details>
      </section>
    </section>
  </div>
</body>
</html>
